# Nginx configuration template for deployment pipeline
# Placeholders: __SUBDOMAIN__, __CONTAINER_NAME__, __INTERNAL_PORT__, __USER_ID__, __DATASET_ID__

upstream __CONTAINER_NAME___upstream {
    server __CONTAINER_NAME__:__INTERNAL_PORT__;
    keepalive 16;
}

server {
    listen 80;
    server_name __SUBDOMAIN__;
    
    location / {
        proxy_pass http://__CONTAINER_NAME___upstream;
        proxy_set_header Host 127.0.0.1; # prevent blocked requests by vite
        proxy_connect_timeout   5s;
        proxy_send_timeout      60s;
        proxy_read_timeout      60s;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
        
        # Disable caching - always fetch latest
        add_header Cache-Control "no-cache, no-store, must-revalidate" always;
        add_header Pragma "no-cache" always;
        add_header Expires "0" always;
    }
}

